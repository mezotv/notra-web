---
interface Props {
  href: string;
}

const { href, ...rest } = Astro.props;

const hostname = new URL(href).hostname;
const isExternalLink = hostname !== null;
const faviconUrl = isExternalLink ? `https://icons.duckduckgo.com/ip3/${hostname}.ico` : null;

const invertedFavicons = [
  'github.com',
];
const isInvertedFavicon = invertedFavicons.includes(hostname);
---

{isExternalLink ? (
  <a href={href} {...rest} class="favicon-link">
    <img
      src={faviconUrl}
      alt=""
      class:list={["favicon-icon", { "favicon-inverted": isInvertedFavicon }]}
      width="16"
      height="16"
      loading="lazy"
    />
    <slot />
  </a>
) : (
  <a href={href} {...rest}>
    <slot />
  </a>
)}

<style>
  .favicon-link {
    position: relative;
    padding-left: 20px;
  }

  .favicon-icon {
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 16px;
    height: 16px;
  }

  @media (prefers-color-scheme: dark) {
    .favicon-inverted {
      filter: invert(1);
    }
  }
</style>
